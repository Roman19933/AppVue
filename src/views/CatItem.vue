<template>
  <div>
    <div class="products">
      <div class="up-btn">
        <img src="img/up.png" alt />
      </div>
      <div class="products__left">
        <button class="products__left-close">
          <svg class="icon-svg icon-svg-close-modal close-filter">
            <use xlink:href="img/sprite.svg#close-modal" />
          </svg>
        </button>
        <form action="#">
          <div class="products__filter">
            <div class="products__filter-title">
              <h2>Фильтр по каталогу</h2>
            </div>
            <div class="products__filter-item">
              <a href="#" class="products__filter-item__title preventDefault">
                <svg class="icon-svg icon-svg-arrow filter-arrow">
                  <use xlink:href="img/sprite.svg#arrow" />
                </svg>
                <span>Горошки для цветов</span>
              </a>
              <div class="products__filter-content">
                <ul>
                  <li>
                    <div class="products__filter-item">
                      <a
                        href="#"
                        class="products__filter-item__title preventDefault"
                      >
                        <svg class="icon-svg icon-svg-arrow filter-arrow">
                          <use xlink:href="img/sprite.svg#arrow" />
                        </svg>
                        <span>Горошки для цветов</span>
                      </a>
                      <div class="products__filter-content">
                        <ul>
                          <li>
                            <a href="#" class="active">Баклажаны</a>
                          </li>
                          <li>
                            <a href="#">Бобы</a>
                          </li>
                          <li>
                            <a href="#">Брюква</a>
                          </li>
                          <li>
                            <a href="#">сельскохозяйственные</a>
                          </li>
                          <li>
                            <a href="#">салаты</a>
                          </li>
                          <li>
                            <a href="#">сельдерей</a>
                          </li>
                          <li>
                            <a href="#">лук</a>
                          </li>
                          <li>
                            <a href="#">шпинат</a>
                          </li>
                          <li>
                            <a href="#">щавель</a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
            <div class="products__filter-item">
              <a href="#" class="products__filter-item__title preventDefault">
                <svg class="icon-svg icon-svg-arrow filter-arrow">
                  <use xlink:href="img/sprite.svg#arrow" />
                </svg>
                <span>Горошки для зассады</span>
              </a>
              <div class="products__filter-content">
                <ul>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="products__filter-item">
              <a href="#" class="products__filter-item__title preventDefault">
                <svg class="icon-svg icon-svg-arrow filter-arrow">
                  <use xlink:href="img/sprite.svg#arrow" />
                </svg>
                <span>Хозяйственные товары</span>
              </a>
              <div class="products__filter-content">
                <ul>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="products__filter-item">
              <a href="#" class="products__filter-item__title preventDefault">
                <svg class="icon-svg icon-svg-arrow filter-arrow">
                  <use xlink:href="img/sprite.svg#arrow" />
                </svg>
                <span>Миниральные удобрения</span>
              </a>
              <div class="products__filter-content">
                <ul>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="products__filter-item">
              <a href="#" class="products__filter-item__title preventDefault">
                <svg class="icon-svg icon-svg-arrow filter-arrow">
                  <use xlink:href="img/sprite.svg#arrow" />
                </svg>
                <span>Органические удобрение и почвы</span>
              </a>
              <div class="products__filter-content">
                <ul>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="products__filter-item">
              <a href="#" class="products__filter-item__title preventDefault">
                <svg class="icon-svg icon-svg-arrow filter-arrow">
                  <use xlink:href="img/sprite.svg#arrow" />
                </svg>
                <span>Пакетированные семена</span>
              </a>
              <div class="products__filter-content">
                <ul>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                  <li>
                    <a href="#">Баклажаны</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="products__filter">
            <div class="products__filter-title">
              <h2>Сортировать по массе</h2>
            </div>
            <div class="products__filter-content products__filter-content_btn">
              <div class="products__filter-radio">
                <label class="radio">
                  <input type="checkbox" class="radio__input" />
                  <span class="radio__custom"></span>
                  <span class="radio__text">Сначала дороже</span>
                </label>
              </div>
              <div class="products__filter-radio">
                <label class="radio">
                  <input type="checkbox" class="radio__input" />
                  <span class="radio__custom"></span>
                  <span class="radio__text">Сначала дешевле</span>
                </label>
              </div>
            </div>
          </div>
          <div class="products__filter">
            <div class="products__filter-title">
              <h2>Сортировать по серии</h2>
            </div>
            <div class="products__filter-content products__filter-content_btn">
              <div class="products__filter-radio">
                <label class="radio">
                  <input type="checkbox" class="radio__input" />
                  <span class="radio__custom"></span>
                  <span class="radio__text">По спаданию</span>
                </label>
              </div>
              <div class="products__filter-radio">
                <label class="radio">
                  <input type="checkbox" class="radio__input" />
                  <span class="radio__custom"></span>
                  <span class="radio__text">По возрастанию</span>
                </label>
              </div>
            </div>
          </div>
          <div class="products__filter">
            <div class="products__filter-title">
              <h2>Сортировать по длине</h2>
            </div>
            <div class="products__filter-content products__filter-content_btn">
              <div class="products__filter-radio">
                <label class="radio">
                  <input type="checkbox" class="radio__input" />
                  <span class="radio__custom"></span>
                  <span class="radio__text">По спаданию</span>
                </label>
              </div>
              <div class="products__filter-radio">
                <label class="radio">
                  <input type="checkbox" class="radio__input" />
                  <span class="radio__custom"></span>
                  <span class="radio__text">По возрастанию</span>
                </label>
              </div>
            </div>
          </div>
          <button type="submit" class="button button__filter">
            Сбросить фильтр
          </button>
        </form>
      </div>
      <div class="products__wrapper">
        <b-breadcrumb>
          <b-breadcrumb-item to="/">Главная</b-breadcrumb-item>
          <b-breadcrumb-item to="/catalog">Каталог</b-breadcrumb-item>
          <b-breadcrumb-item active>{{
            this.getCategoryName[0].name
          }}</b-breadcrumb-item>
        </b-breadcrumb>
        <div class="products__right padding" id="product">
          <div class="products__title title">
            <h2>Товары</h2>
            <div class="products__filters">
              <a href="#" class="click-sort">
                <svg class="icon-svg icon-svg-filter filter">
                  <use xlink:href="../assets/img/sprite.svg#filter" />
                </svg>
                <span>Фильтры и сортировка</span>
              </a>
              <div class="dropdown">
                <v-select
                  v-model="filter"
                  :options="filterList"
                  class="filterDropdown"
                ></v-select>
              </div>
            </div>
          </div>
          <div class="min-count">
            <p>
              Мин. сумма заказа -
              <span>300</span> грн.
            </p>
          </div>
          <div class="products__items">
            <cardProduct
              v-for="(item, index) in displayedPosts"
              :key="index"
              :product="item"
            />
          </div>
        </div>
        <div class="products__pagination" v-if="this.getProductToCategory.length > this.perPage">
          <nav>
            <ul class="pagination">
              <router-link
                class="page-item"
                tag="button"
                :to="{ query: { page: this.page } }"
              >
                <span class="page-link">‹</span>
              </router-link>
              <router-link
                class="page-item"
                tag="button"
                :to="{ query: { page: item } }"
                v-for="(item, index) in pages"
                :key="index"
                activeClass="active"
                exact
              >
                <span class="page-link" @click="page = item">{{ item }}</span>
              </router-link>
              <router-link
                class="page-item"
                tag="button"
                :to="{ query: { page: this.page } }"
                @click="console.log('ok')"
              >
                <span class="page-link">›</span>
              </router-link>
            </ul>
          </nav>
        </div>
        <div class="home__seo default-container">
          <p>
            Не следует, однако забывать, что реализация намеченных плановых
            заданий обеспечивает широкому кругу (специалистов) участие в
            формировании существенных финансовых и административных условий.
            Повседневная практика показывает
          </p>
        </div>
      </div>
    </div>
    <!-- <div class="loader" v-if="isLoader">
      <div class="loader__wrapper">
        <div class="load">
          <hr />
          <hr />
        </div>
      </div>
    </div> -->
  </div>
</template>

<script>
import { mapGetters, mapActions } from "vuex";
import cardProduct from "../components/loyauts/card/cardProduct";
export default {
  data() {
    return {
      filterList: ["От A-Z", "От Z-A", "По возростанию", "По спаданию"],
      filter: "Сортировать...",
      page: 1,
      perPage: 3,
      pages: [],
      // isLoader:false
    };
  },
  components: {
    cardProduct
  },
  watch: {
    filter: function(val) {
      if (val == "От A-Z") {
        this.displayedPosts.sort((a, b) => a.name.localeCompare(b.name));
      } else if (val == "От Z-A") {
        this.displayedPosts.sort((a, b) => b.name.localeCompare(a.name));
      } else if (val == "По возростанию") {
        this.displayedPosts.sort((a, b) => a.newPrice - b.newPrice);
      } else if (val == "По спаданию") {
        this.displayedPosts.sort((a, b) => b.newPrice - a.newPrice);
      }
    },
    getProductToCategory: function() {
      this.setPages();
    }
  },
  computed: {
    ...mapGetters(["getProducts", "addBasketProduct","getCategories"]),
    getProductToCategory: function() {
      return this.getProducts.filter(item => {
        if (item.categoryLink == this.$route.params.id) {
          return item;
        }
        // this.isLoader=false
      });
    },
    getCategoryName:function(){
      return this.getCategories.filter(item => {
        if(item.linkName == this.$route.params.id) {
          return item
        }
      })
    },
    displayedPosts() {
      return this.paginate(this.getProductToCategory);
    }
  },
  methods: {
    setPages() {
      let numberOfPages = Math.ceil(
        this.getProductToCategory.length / this.perPage
      );
      for (let index = 1; index <= numberOfPages; index++) {
        this.pages = index;
      }
    },
    paginate(posts) {
      let page = this.page;
      let perPage = this.perPage;
      let from = page * perPage - perPage;
      let to = page * perPage;
      return posts.slice(from, to);
    }
  },
  mounted() {
    // this.isLoader=true
    this.$store.dispatch("getProductsAction");
    this.$store.dispatch("getCategoriesAction");
    console.log(this.getProductToCategory.length);
    console.log(this.pages);
    console.dir(this.displayedPosts);
    console.log(this.getProductToCategory);
    console.log(this.perPage);
    // this.setPages()
  }
};
</script>

<style lang="scss">
.dropdown {
  width: 211px;
  height: 34px;
}
.filterDropdown {
  // .vs__dropdown-toggle {
  //   border: 1px solid #b8adab;
  //   border-radius: 15px;
  //   font-size: 15px;
  //   padding: 5px 25px;
  //   display: flex;
  //   justify-content: space-between;
  //   align-items: center;
  // }
  height: 100%;
  .vs {
    &__dropdown {
      &-toggle {
        cursor: pointer;
        border: 1px solid #b8adab;
        border-radius: 15px;
        font-size: 15px;
        padding: 5px 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 100%;
      }
      &-menu {
        border-radius: 15px;
        padding: 15px 15px;
        top: 35px;
        box-shadow: none;
        border-top-style: solid;
      }
      &-option {
        font-size: 15px;
        font-family: "Helvetica-Regular";
        padding: 0;
        margin-bottom: 15px;
        &--highlight {
          background: none;
          color: #b1c962;
          transition: 0.3s;
        }
      }
    }
    &__selected {
      font-size: 15px;
      margin: 0;
      &-options {
        flex-wrap: nowrap;
      }
    }
    &__clear {
      display: none;
    }
    &__search {
      pointer-events: none;
      &:focus {
        font-size: 15px;
      }
    }
    &__open {
      &-indicator {
        // width:11px;
        // height:5px;
      }
    }
  }
}
</style>
